{extends file="admin-layout.tpl"}

{block name="no-return-functions"}
{$admin_current_location = 'TheliaBlocks'}
{/block}

{block name="page-title"}{intl l='Thelia Page'}{/block}

{block name="check-resource"}admin.content{/block}
{block name="check-access"}view{/block}

{block name="main-content"}
<div class="categories">

  <div id="wrapper" class="container">
    <div class="row">
      <div class="col-md-12">
        <div class="general-block-decorator">
          <div class="table-responsive">
            <table class="table table-striped table-condensed" id="category_list">
              <caption>
                {* display parent category name, and get current cat ID *}
                {intl l="Liste des pages"}

                {include file='renderer/buttons.html' btn_group=false buttons=[
                [
                'type' => 'create',
                'class' => 'action-btn',
                'title' => {intl l='Ajouter une page'},
                'href' => '#page_creation_dialog',
                'auth' => ['resource' => 'admin.category'],
                'data' => [
                'toggle' => 'modal'
                ]
                ]
                ]}
              </caption>
              {ifloop rel="TheliaBlocks_list"}
                <thead>
                <tr>
                  <th class="object-title">
                  ID
                  </th>

                  <th class="object-title">
                  Data
                  </th>

                  <th class="actions">{intl l='Actions'}</th>
                </tr>
                </thead>
              <tbody>
                {loop type="TheliaBlocks.list" name="TheliaBlocks_list"}
                  <tr>
                    <td>{$ID}</td>

                    <td>
                      {$DATA}
                    </td>

                    <td class="actions">
                      {include file='renderer/buttons.html' buttons=[
                      [
                      'type' => 'edit',
                      'title' => {intl l='Modifier cette page'},
                      'href' => {url path='/admin/TheliaBlocks/update' page_id=$ID},
                      'auth' => ['resource' => 'admin.content']
                      ],
                      [
                      'type' => 'delete',
                      'class' => 'TheliaBlocks-delete',
                      'title' => {intl l='Supprimer cette page'},
                      'href' => '#TheliaBlocks_delete_dialog',
                      'data' => [
                      'id' => $ID,
                      'toggle' => 'modal'
                      ],
                      'auth' => ['resource' => 'admin.content']
                      ]
                      ]}
                    </td>
                  </tr>
                {/loop}
                </tbody>
              {/ifloop}
              {elseloop rel="TheliaBlocks_list"}
              <thead>
              <tr>
                <td class="message">
                  <div class="alert alert-info">
                    {loop type="auth" name="can_create" role="ADMIN" resource="admin.content" access="CREATE"}
                    {intl l="Il n'y a pas de Page. Pour en cr√©er une nouvelle, cliquez sur le bouton + ci-dessus."}
                    {/loop}

                    {elseloop rel="can_create"}
                      {intl l="Il n'y a pas de Page."}
                    {/elseloop}
                  </div>
                </td>
              </tr>
              </thead>
              {/elseloop}
            </table>
          </div>
        </div>
      </div>
    </div>



    {* -- Adding a new category ------------------------------------------------- *}

    {form name="thelia.admin.seo"}

    {* Capture the dialog body, to pass it to the generic dialog *}
    {capture "page_creation_dialog"}

    {form_hidden_fields exclude="parent,locale"}

    <input type="hidden" {form_field_attributes field='parent' value={$category_id}}>

    {* on success, redirect to the edition page, _ID_ is replaced with the created object ID, see controller  *}
    {render_form_field field="success_url" value={url path='/admin/categories/update' category_id='_ID_'}}

    {custom_render_form_field field="title"}
    {loop type="lang" name="default-lang" default_only="1"}
    <div class="input-group">
      <input type="text" {form_field_attributes field="title"}>
      <span class="input-group-addon"><img src="{image file="assets/img/flags/$CODE.png"}" alt="{$TITLE}" /></span>
    </div>

    {* Switch edition to the current locale *}
    <input type="hidden" name="edit_language_id" value="{$ID}" />

    {render_form_field field="locale" value=$LOCALE}
    {/loop}
    {/custom_render_form_field}


    {hook name="category.create-form" location="category_create_form" }

    {/capture}

    {include
    file = "includes/generic-create-dialog.html"

    dialog_id    = "page_creation_dialog"
    dialog_title = {intl l="Create a new category"}
    dialog_body  = {$smarty.capture.page_creation_dialog nofilter}

    dialog_ok_label     = {intl l="Create this category"}

    form_action        = {url path='/admin/categories/create'}
    form_enctype       = {form_enctype}
    form_error_message = $form_error_message
    }
    {/form}


{/block}
{block name="javascript-initialization"}
    <script>
        {include
            file      = "includes/generic-js-dialog.html"
            dialog_id = "page_creation_dialog"
            form_name = "thelia.admin.category.creation"
        }
    </script>
{/block}

